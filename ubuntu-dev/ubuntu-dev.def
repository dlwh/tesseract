Bootstrap: library
From: ubuntu:20.04
Stage: build

%post
    # Generic Updates
    apt-get -y update
    apt-get -y install curl git gzip less python-is-python3 python3-distutils python3-apt tar unzip vim wget

    # Install Anaconda (Full) for Python Environment Management --> installing to /usr/local makes available for all!
    wget https://repo.anaconda.com/archive/Anaconda3-2020.11-Linux-x86_64.sh -O ~/anaconda.sh
    /bin/bash ~/anaconda.sh -bfp /usr/local

    # Conda configuration of channels from .condarc file
    conda config --file /.condarc --add channels defaults
    conda config --file /.condarc --add channels conda-forge
    conda update conda

    # Set Conda Path
    echo ". /usr/local/etc/profile.d/conda.sh" >> $SINGULARITY_ENVIRONMENT

    # Versioning & Timestamping
    CONTAINER_NAME="ubuntu-dev"
    CONTAINER_VERSION="0.0.1"
    NOW=`date`
    echo "export CONTAINER_NAME=\"${CONTAINER_NAME}\"" >> $SINGULARITY_ENVIRONMENT
    echo "export CONTAINER_VERSION=\"${CONTAINER_VERSION}\"" >> $SINGULARITY_ENVIRONMENT
    echo "export NOW=\"${NOW}\"" >> $SINGULARITY_ENVIRONMENT

%runscript
    echo "Running with Container '$CONTAINER_NAME' -- Version '$CONTAINER_VERSION' -- Created at $NOW"
    echo "Arguments received: $*"
    exec "$@"

%labels
    Author Siddharth Karamcheti
    Email skaramcheti@cs.stanford.edu
    Organization Pantheon-616
    Version v0.0.1

%help
    This is a default Ubuntu 20.04 container geared for Python + GPU Development, with sane defaults.